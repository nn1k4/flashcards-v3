# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî –≠—Ç–∞–ø 1 (MVP v1)

–°–≤—è–∑–∫–∞ —Å –¢–ó: **TRS v5.1** (¬ß1‚Äì¬ß8, ¬ß9, ¬ß10, ¬ß11, ¬ß12, ¬ß14‚Äì¬ß18, ¬ß20 ‚Äî ¬´MVP (v1)¬ª). –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–æ–∫–æ–≤:
–æ—Ñ. Anthropic ‚Üí `doc/best_practices/TechnicalGuidesForClaudeAPIv2.0.md` ‚Üí `Message Batches.md` /
`MessageBatches2.md` ‚Üí `tool-use.md`.

---

## 0) –ü—Ä–∏–Ω—Ü–∏–ø—ã –∏ –≥—Ä–∞–Ω–∏—Ü—ã MVP

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ä–µ–∂–∏–º—ã: **Text ‚Üí Flashcards ‚Üí Reading ‚Üí Translation ‚Üí Edit**.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **–æ–¥–∏–Ω–æ—á–Ω–æ–π** –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ **–ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º–æ–≥–æ batch-—Ä–µ–∂–∏–º–∞** (–±–µ–∑ JSONL-–∏–º–ø–æ—Ä—Ç–∞; –∏–º–ø–æ—Ä—Ç –≤
  v1.1).
- **Tool-use JSON-only**: –≤—Å–µ LLM-–≤—ã–∑–æ–≤—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π emitter-tool** —Å `tool_choice`;
  –ø–∞—Ä—Å–∏–Ω–≥ –∏–∑ `tool_use.input` + **Zod**.
- **Prompt caching hygiene**: —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã `system` –∏ `tools` (–∫—ç—à–∏—Ä—É–µ–º—ã–µ), –∏–∑–º–µ–Ω—è–µ–º –≤ –æ—Å–Ω–æ–≤–Ω–æ–º
  `messages.user`.
- **Stop reasons**: –º–∏–Ω–∏–º—É–º ‚Äî –¥–µ—Ç–µ–∫—Ç `max_tokens` + **bump/split-retry** –ª–æ–≥–∏–∫–∞ (UI-—É–ª—É—á—à–µ–Ω–∏—è –∏
  —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è ‚Äî –≤ v1.1).
- **Config-first**: –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ `/config` (Zod-–≤–∞–ª–∏–¥–∞—Ü–∏—è), **–Ω–∏–∫–∞–∫–∏—Ö —Ö–∞—Ä–¥–∫–æ–¥–æ–≤** (–∞–Ω—Ç–∏-–ª–∏–Ω—Ç).
- –û—à–∏–±–∫–∏ –∏ —Å—Ç–∞—Ç—É—Å—ã ‚Äî **–±–∞–Ω–Ω–µ—Ä—ã –≤ UI** + –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π polling + —É–≤–∞–∂–µ–Ω–∏–µ `Retry-After`.
- –¢–µ—Å—Ç—ã: **unit + integration + E2E (Cypress)**. –õ–∏–Ω—Ç: **eslint-formatter-codeframe**.

–ù–µ –≤—Ö–æ–¥—è—Ç –≤ MVP (–ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã): –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –ü–ö–ú, Restore/Undo, JSONL-–∏–º–ø–æ—Ä—Ç,
OCR/PDF/Subtitles, Media follow-highlight, –ø—Ä–æ—Ñ–∏–ª–∏/–ø–æ–¥–ø–∏—Å–∫–∏.

---

## 1) –¢—Ä–µ–∫–∏ —Ä–∞–±–æ—Ç –∏ –∑–∞–¥–∞—á–∏

### 1.1 –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –∫–æ–Ω—Ñ–∏–≥–∏

- [ ] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `/config/*.json` + Zod-—Å—Ö–µ–º—ã: `app`, `i18n`, `theme`, `network`, `llm`, `batch`,
      `flashcards`, `reading`, `translation`, `edit`, `io`.
- [ ] –í–∞–ª–∏–¥–∞—Ç–æ—Ä –∫–æ–Ω—Ñ–∏–≥–æ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ; –∫–æ–º–∞–Ω–¥–∞ `npm run validate:config`.
- [ ] –°–∫—Ä–∏–ø—Ç ¬´–∞–Ω—Ç–∏-—Ö–∞—Ä–¥–∫–æ–¥¬ª (`lint:anti-hardcode`) + ESLint c `eslint-formatter-codeframe`.
- [ ] RU-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è `/doc/configs/*` (–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–ª—é—á–µ–π, –¥–µ—Ñ–æ–ª—Ç—ã, –ø—Ä–∏–º–µ—Ä—ã, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏).

### 1.2 Backend-proxy (ESM, Node 24)

- [ ] `/api/health` (–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å/–≤–µ—Ä—Å–∏–∏/–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω–µ—à–Ω–µ–π —Å–µ—Ç–∏; —Ç–∞–π–º–∞—É—Ç –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞).
- [ ] –û–±—ë—Ä—Ç–∫–∏ Anthropic: `/api/batch/{create,status,result}`, `/api/llm/single`.
- [ ] –ü–æ–ª–∏—Ç–∏–∫–∏ —Ç–∞–π–º–∞—É—Ç–æ–≤/—Ä–µ—Ç—Ä–∞–µ–≤/–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ rate-limit (—É–≤–∞–∂–∞—Ç—å `Retry-After`).
- [ ] –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—à–∏–±–æ–∫: 429/413/500/529 + —Å–æ–≤–µ—Ç—ã –¥–ª—è UI; –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–µ–≤—ã—Ö/–ø—Ä–æ–∫—Å–∏ –æ—à–∏–±–æ–∫.

### 1.3 Pipeline –∏ –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (Manifest/SID + Tool-use)

- [ ] **Segmentation**: `latvian_sentence_tester:local`; –¥–µ—Ñ–æ–ª—Ç **1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ/—á–∞–Ω–∫**, –ª–∏–º–∏—Ç \~300
      —Ç–æ–∫–µ–Ω–æ–≤ ‚Äî –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞.
- [ ] **Manifest**: `{ sid, lv, sig }` –∏–∑ —Å–ø–∞–Ω–æ–≤ (SID = hash(docId\:start\:end)).
- [ ] **Tool-use builder**: —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ `system` + `tools` + `tool_choice` (emitter); `cache_control`
      –¥–ª—è –∫—ç—à–∏—Ä—É–µ–º—ã—Ö –±–ª–æ–∫–æ–≤.
- [ ] **Parser**: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ `tool_use` –Ω—É–∂–Ω–æ–≥–æ –∏–º–µ–Ω–∏, –ø–∞—Ä—Å–∏–Ω–≥ `tool_use.input`,
      Zod-–≤–∞–ª–∏–¥–∞—Ü–∏—è.
- [ ] **Stop reasons**: –æ–±—Ä–∞–±–æ—Ç–∫–∞ `max_tokens` ‚Äî single: bump; batch: split-retry —Ç–æ–ª—å–∫–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö
      —á–∞–Ω–∫–æ–≤ (—á–∞—Å—Ç–∏—á–Ω—ã–µ —É—Å–ø–µ—Ö–∏ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è).
- [ ] **Adapters**: `LLMAdapter` (single), `BatchAdapter` (create/status/result); –∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ
      **SID** (JSONL-–ø–æ—Ä—è–¥–æ–∫ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è).

### 1.4 UI: Text

- [ ] –ü–æ–ª–µ –≤–≤–æ–¥–∞ (–ª–∏–º–∏—Ç –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞), –∫–Ω–æ–ø–∫–∞ **–û—á–∏—Å—Ç–∏—Ç—å**.
- [ ] –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–∫–µ—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É** ‚Äî –º–µ–Ω—è–µ—Ç —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –Ω–∞ ¬´–ù–∞—á–∞—Ç—å –ø–∞–∫–µ—Ç–Ω—É—é
      –æ–±—Ä–∞–±–æ—Ç–∫—É¬ª.
- [ ] –ü—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–π –≥–∞–ª–æ—á–∫–µ ‚Äî —Ñ–æ—Ä–º–∞ ¬´–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã batch¬ª: `batch_id`, –ó–∞–≥—Ä—É–∑–∏—Ç—å, –∏—Å—Ç–æ—Ä–∏—è —Å
      –ø–æ–º–µ—Ç–∫–æ–π **–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ** (‚â•29 –¥–Ω–µ–π).
- [ ] **Pre-flight** `/api/health` –ø–µ—Ä–µ–¥ –ª—é–±—ã–º —Å—Ç–∞—Ä—Ç–æ–º/–∑–∞–≥—Ä—É–∑–∫–æ–π.

### 1.5 UI: Flashcards

- [ ] –ö–∞—Ä—Ç–æ—á–∫–∏: front/back; –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã (N –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, ¬´–ø–æ–∫–∞–∑–∞—Ç—å –±–æ–ª—å—à–µ¬ª –¥–æ M ‚Äî –∏–∑ –∫–æ–Ω—Ñ–∏–≥–æ–≤).
- [ ] –•–æ—Ç–∫–µ–∏: ‚Üê/‚Üí (–Ω–∞–≤–∏–≥–∞—Ü–∏—è), Space/‚Üë/‚Üì (flip), `h` (—Å–∫—Ä—ã—Ç—å).
- [ ] –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ü–µ–ª–µ–≤–æ–π —Ñ–æ—Ä–º—ã –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö; –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –≤—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞—Ç—å —Å **front**.
- [ ] –°—Ç–∏–ª–∏/—à—Ä–∏—Ñ—Ç/–∞–Ω–∏–º–∞—Ü–∏—è flip ‚Äî –∏–∑ –∫–æ–Ω—Ñ–∏–≥–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `Noto Sans Display`).
- [ ] –ü–æ–ª–∏—Ç–∏–∫–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏: `all-visible` (–¥–µ—Ñ–æ–ª—Ç).

### 1.6 UI: Reading

- [ ] –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–ª–æ–≤ (A) –∏ —Ñ—Ä–∞–∑ (B) —Å –ª–µ–≥–µ–Ω–¥–æ–π; –ø—Ä–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–∏ ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç **—Ñ—Ä–∞–∑—ã**.
- [ ] Tooltip: surface-—Ñ–æ—Ä–º–∞, –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ viewport; –º–æ–±–∏–ª—å–Ω—ã–π popover/bottom-sheet.
- [ ] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: `tooltip.showDelayMs` (–¥–µ—Ñ–æ–ª—Ç 0), `debounceMs`, `cancelOnLeave`,
      **single-flight** –∑–∞–ø—Ä–æ—Å–æ–≤.

### 1.7 UI: Translation

- [ ] –ü–∞–Ω–µ–ª—å –ø–µ—Ä–µ–≤–æ–¥–∞; —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: —Å–ª–æ–≤–∞ (UAX-29), —Å–∏–º–≤–æ–ª—ã (–≥—Ä–∞—Ñ–µ–º—ã), –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (–ø–æ SID), —Ñ—Ä–∞–∑—ã
      (unique|occurrences).

### 1.8 UI: Edit

- [ ] –¢–∞–±–ª–∏—Ü–∞ –∫–∞—Ä—Ç–æ—á–µ–∫: –ø–∞–≥–∏–Ω–∞—Ü–∏—è (`pageSize`), –ø–æ–∏—Å–∫ –ø–æ –±–∞–∑–æ–≤–æ–π —Ñ–æ—Ä–º–µ/–ø–µ—Ä–µ–≤–æ–¥—É (–æ–ø—Ü.: –ø–æ
      –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º).
- [ ] –ß–µ–∫–±–æ–∫—Å **VISIBLE** + **Master Visible** (–¥–ª—è –≤—Å–µ—Ö/—Ñ–∏–ª—å—Ç—Ä–∞).
- [ ] –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ **–±–∞–∑–æ–≤–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞** –∏ **–ø–µ—Ä–µ–≤–æ–¥–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤**; –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–ø–∞–≥–∞—Ü–∏—è –≤
      Flashcards/Reading/Translation.
- [ ] –°—Å—ã–ª–∫–∞ ¬´–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã (N)¬ª (–º–æ–¥–∞–ª/—Ç–∞–±–ª–∏—Ü–∞). **Clear** ‚Äî —Ç–æ–ª—å–∫–æ –≤ —Ö–µ–¥–µ—Ä–µ.

### 1.9 Import/Export JSON

- [ ] –≠–∫—Å–ø–æ—Ä—Ç –ø–æ–ª–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è (—Å –ø—Ä–∞–≤–∫–∞–º–∏) + –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
      `appVersion/schemaVersion/exportedAt/locale/targetLanguage`.
- [ ] –ò–º–ø–æ—Ä—Ç: –ø—Ä–µ–≤—å—é –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ `replace-all | merge-keep-local | merge-prefer-imported`
      (–¥–µ—Ñ–æ–ª—Ç ‚Äî –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞).
- [ ] –û—Ç—á—ë—Ç—ã –æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ/–æ—à–∏–±–∫–∞—Ö (–ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –±–∞–Ω–Ω–µ—Ä—ã).

### 1.10 i18n/Themes

- [ ] `/src/locales/{ru,uk,en}.json` (–º–∏–Ω–∏–º—É–º ru/en –≤ MVP), –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–∞.
- [ ] –¢–µ–º–∞: light/dark/system; —É–≤–∞–∂–µ–Ω–∏–µ `prefers-color-scheme`.

### 1.11 –û—à–∏–±–∫–∏/–±–∞–Ω–Ω–µ—Ä—ã/—Å—Ç–∞—Ç—É—Å—ã

- [ ] –ë–∞–Ω–Ω–µ—Ä—ã –ø—Ä–∏: –ø—Ä–æ–∫—Å–∏ down, –Ω–µ—Ç —Å–µ—Ç–∏, 429/413/500/529, **expired batch**, –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤.
- [ ] –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π polling —Ñ—Ä–æ–Ω—Ç–∞ (1‚Äì2—Å ‚Üí 3‚Äì5—Å ‚Üí 10‚Äì30—Å ‚Üí 30‚Äì60—Å) + jitter; respect `Retry-After`.

### 1.12 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/–∫–∞—á–µ—Å—Ç–≤–æ

- [ ] Unit: –ø–æ–¥—Å—á—ë—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫, tooltip-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä (delay/debounce/cancel/single-flight), reducers
      Stores, –ø–∞—Ä—Å–µ—Ä JSONL –∏ merge, –∞–Ω—Ç–∏-—Ö–∞—Ä–¥–∫–æ–¥, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫.
- [ ] Integration: batch create/status/result; pre-flight –∏ –±–∞–Ω–Ω–µ—Ä—ã; –ø—Ä–æ–ø–∞–≥–∞—Ü–∏—è
      Edit‚ÜíFlashcards/Reading/Translation; tool-use –ø–∞—Ä—Å–∏–Ω–≥ (`tool_use.input`).
- [ ] E2E (Cypress): happy-path –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤; –æ—à–∏–±–∫–∏ —Å–µ—Ç–∏/–ø—Ä–æ–∫—Å–∏; batch-–∏—Å—Ç–æ—Ä–∏—è; –∏–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç;
      –±–∞–∑–æ–≤—ã–π UX `max_tokens` (–±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤).
- [ ] CI-—Å–∫—Ä–∏–ø—Ç—ã: `lint`, `test`, `build`, `validate:config`.

---

## 2) –°–∫–µ–ª–µ—Ç —Å–ø—Ä–∏–Ω—Ç–æ–≤ (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç)

### S0 ‚Äî –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

- –ö–æ–Ω—Ñ–∏–≥–∏ + Zod; –∞–Ω—Ç–∏-—Ö–∞—Ä–¥–∫–æ–¥; ESLint codeframe; –±–∞–∑–æ–≤–∞—è i18n/theming; –∑–∞–≥–æ—Ç–æ–≤–∫–∏ Stores;
  –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥–æ–≤ (RU).

### S1 ‚Äî Proxy & Health & –û—à–∏–±–∫–∏

- ESM-–ø—Ä–æ–∫—Å–∏, `/api/health`, –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—à–∏–±–æ–∫, –±–∞–Ω–Ω–µ—Ä—ã, –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π polling, —É–≤–∞–∂–µ–Ω–∏–µ
  `Retry-After`.

Status: ‚úÖ Done (Acceptance met)

‚ÑπÔ∏è –°–µ—Ä–≤–µ—Ä ‚Äî mock (/claude/batch\*); production tool-use ‚Äî –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω.

- Health preflight `/api/health` –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ.
- –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –±–∞–Ω–Ω–µ—Ä—ã –æ—à–∏–±–æ–∫: 429, 413, 5xx, 529, —Å–µ—Ç—å, proxy-down, expired (‚â•29 –¥–Ω–µ–π),
  batch_not_found ‚Äî –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω—ã.
- Polling: –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –∏–∑ `config/batch.json` —Å jitter; `Retry-After` —É–≤–∞–∂–∞–µ—Ç—Å—è.
- –¢–µ—Å—Ç—ã: unit/RTL –ø–æ–∫—Ä—ã–≤–∞—é—Ç health, Retry-After, –º–∞–ø–ø–∏–Ω–≥ –æ—à–∏–±–æ–∫ ‚Üí –±–∞–Ω–Ω–µ—Ä—ã, –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
  ErrorBanners.

### S2 ‚Äî Pipeline Core (Manifest/SID + Tool-use)

- `latvian_sentence_tester:local` —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è; Manifest.
- **Tool-use builder** (stable `system/tools/tool_choice` + cache_control), **Parser**
  (`tool_use.input` + Zod), –∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ SID.
- LLMAdapter (single), BatchAdapter (create/status/result).

üöß –í –ø—Ä–æ—Ü–µ—Å—Å–µ (~50‚Äì55%). –Ø–¥—Ä–æ –≥–æ—Ç–æ–≤–æ; –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç tool-use —Å–ª–æ–π (LLMAdapter/BatchAdapter,
emit_flashcards schema).

Status

- ‚úÖ FSM + —Å–µ–ª–µ–∫—Ç–æ—Ä—ã/—Ñ–ª–∞–≥–∏; ‚úÖ useBatch/useBatchPipeline; ‚úÖ –∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ SID; ‚úÖ Retry-After; ‚úÖ
  ErrorBanners; ‚úÖ Zod DTO/Manifest; ‚úÖ –∫–æ–Ω—Ñ–∏–≥–∏; ‚úÖ —Ç–µ—Å—Ç—ã.
- ‚ùå Tool-use adapters (LLMAdapter/BatchAdapter); ‚ùå Zod-—Å—Ö–µ–º–∞ emit_flashcards; ‚ùå –ø–∞—Ä—Å–µ—Ä JSON-only
  tool_use.

TODO

1. –í–≤–µ—Å—Ç–∏ src/adapters/LLMAdapter + BatchAdapter (Batches parity).
2. Zod-—Å—Ö–µ–º–∞ emit_flashcards (tool_use.input) –∏ —Å—Ç—Ä–æ–≥–∏–π –ø–∞—Ä—Å –ø–µ—Ä–≤–æ–≥–æ tool_use.
3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å useBatch: custom_id==SID; —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è.
4. –•—É–∫ useLLMToolsEmitter (single/tools; stop reasons, –≤ —Ç.—á. max_tokens).
5. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è RetryQueue: split-retry –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö SID + merge —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.
6. –ß–∞–Ω–∫–æ–≤–∞–Ω–∏–µ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–æ–≤ (–≤—ã–Ω–µ—Å—Ç–∏ maxSentencesPerChunk –∏–∑ –∫–æ–¥–∞).
7. –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è: –∑–∞–¥–µ–ª latvian_sentence_tester:local (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å/—Ñ–ª–∞–≥); –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî primitive.

- FSM: finalized to `{ idle ‚Üí submitted ‚Üí in_progress ‚Üí ready | failed }` with selectors
  `isIdle/isBusy/isDone/isFailed`.
- Polling: uses `config.batch.polling.stages` (min/max + jitter); honors `Retry-After` when
  `batch.polling.respectRetryAfter = true`.
- Public hooks: `useBatch(manifest)` and `useBatchPipeline(maxSentencesPerChunk)`; pipeline exposes
  `submit(text)`, `cancel()`, `pollOnce()`, `submitAttempts`, `pollAttempts`, and derived `elapsed`
  via selectors.
- Error UX: non‚Äëretryable failures push ErrorBanners immediately (no silent failures).
- Tests: FSM transitions; Retry‚ÄëAfter precedence; RTL smoke for an error banner on failed polling.

DoD evidence (tests updated/added)

- `src/__tests__/hooks/fsm.transitions.test.ts`
- `src/__tests__/hooks/polling.retryafter.integration.test.ts`
- `src/__tests__/components/text-stub.errorbanner.test.tsx`

### S3 ‚Äî Flashcards v1

- –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫; –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã N/M; —Ö–æ—Ç–∫–µ–∏; `h` hide; —Å—Ç–∏–ª–∏/flip (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–æ–≤); —Å–±—Ä–æ—Å flip –ø—Ä–∏
  –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.

### S4 ‚Äî Reading v1

- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–ª–æ–≤/—Ñ—Ä–∞–∑ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ñ—Ä–∞–∑—ã), tooltip (delay/debounce/cancel/single-flight),
  –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ viewport.

### S5 ‚Äî Translation v1

- –¢–µ–∫—Å—Ç + —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (UAX-29/–≥—Ä–∞—Ñ–µ–º—ã/SID/—Ñ—Ä–∞–∑—ã).

### S6 ‚Äî Edit v1

- –¢–∞–±–ª–∏—Ü–∞, –ø–æ–∏—Å–∫, VISIBLE + Master Visible, –ø—Ä–∞–≤–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ/–∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ —Å live-–ø—Ä–æ–ø–∞–≥–∞—Ü–∏–µ–π, ¬´–ø—Ä–∞–≤–∏—Ç—å
  –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã (N)¬ª, Clear –≤ —Ö–µ–¥–µ—Ä–µ.

### S7 ‚Äî Import/Export JSON

- –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç, –ø—Ä–µ–≤—å—é/—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ merge, –æ—Ç—á—ë—Ç—ã –æ–± –æ—à–∏–±–∫–∞—Ö.

### S8 ‚Äî Stop-reasons (–º–∏–Ω–∏–º—É–º –¥–ª—è MVP)

- –î–µ—Ç–µ–∫—Ç `max_tokens`; **bump** (single) / **split-retry** (batch) –≤ —Ö—É–∫; —á–∞—Å—Ç–∏—á–Ω—ã–µ —É—Å–ø–µ—Ö–∏ –Ω–µ
  –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è. (–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π UX –∏ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è ‚Äî –≤ v1.1)

### S9 ‚Äî QA-–ø–∞–∫

- Unit + Integration + E2E; –ø–µ—Ä—Ñ-–ø–∞—Å—Å (–≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏); —à–ª–∏—Ñ–æ–≤–∫–∞
  –±–∞–Ω–Ω–µ—Ä–æ–≤/—Ç–µ–∫—Å—Ç–æ–≤; —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥–æ–≤.

---

## 3) Definition of Done (DoD)

- **Config-first**: –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ `/config`; Zod-–≤–∞–ª–∏–¥–∞—Ü–∏—è –∑–µ–ª—ë–Ω–∞—è; –∞–Ω—Ç–∏-—Ö–∞—Ä–¥–∫–æ–¥ –ª–∏–Ω—Ç ‚Äî
  –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏–π.
- **Tool-use JSON-only**: emitter-tool —Å `tool_choice`; –ø–∞—Ä—Å–∏–Ω–≥ `tool_use.input` + Zod; —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ
  `system/tools` –¥–ª—è –∫–µ—à–∞.
- **Batch parity**: —Ç–µ –∂–µ —Ñ–∏—á–∏, —á—Ç–æ –≤ Messages API; –∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ **SID**; JSONL-–ø–æ—Ä—è–¥–æ–∫
  –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è.
- **Stop reasons**: –ª–æ–≥–∏–∫–∞ bump/split-retry —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ (–±–µ–∑ —Å–ª–æ–∂–Ω–æ–≥–æ UI).
- **–û—à–∏–±–∫–∏/–±–∞–Ω–Ω–µ—Ä—ã**: –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ –≤–∏–¥–∏–º—ã–µ –¥–ª—è –ø—Ä–æ–∫—Å–∏/—Å–µ—Ç–∏/429/413/500/529/expired; polling —É–≤–∞–∂–∞–µ—Ç
  `Retry-After`.
- **–†–µ–∂–∏–º—ã**: Flashcards/Reading/Translation/Edit —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç Acceptance –∏–∑ –¢–ó; —Ö–æ—Ç–∫–µ–∏; –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã
  N/M; tooltip-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.
- **Import/Export JSON**: —Ä–µ-–∏–º–ø–æ—Ä—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–Ω–∞–ø—à–æ—Ç–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç **–∏–¥–µ–Ω—Ç–∏—á–Ω–æ–µ
  —Å–æ—Å—Ç–æ—è–Ω–∏–µ**.
- **–¢–µ—Å—Ç—ã**: unit –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π, integration (batch/health/propagation/tool-use), E2E
  happy-path + –æ—à–∏–±–∫–∏ —Å–µ—Ç–∏/–ø—Ä–æ–∫—Å–∏.
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –æ–±–Ω–æ–≤–ª–µ–Ω—ã README, AGENT/Codex, –∫—Ä–∞—Ç–∫–∏–µ RU-–¥–æ–∫–∏ –ø–æ –∫–æ–Ω—Ñ–∏–≥–∞–º.

---

## 4) –†–∏—Å–∫–∏ –∏ —Å–º—è–≥—á–µ–Ω–∏–µ

- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å batches**: —Å—Ç—Ä–æ–≥–æ —Å–ª–µ–¥–æ–≤–∞—Ç—å `TechnicalGuidesForClaudeAPIv2.0.md`; backoff +
  —É–≤–∞–∂–µ–Ω–∏–µ `Retry-After`; —Å–ø–ª–∏—Ç-—Ä–µ—Ç—Ä–∞–∏.
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å Reading**: –∑–∞–¥–µ—Ä–∂–∫–∞ tooltip, debounce, single-flight; –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
  –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞.
- **–ö—ç—à –ø—Ä–æ–º–ø—Ç–æ–≤**: –Ω–µ –º–µ–Ω—è—Ç—å —á–∞—Å—Ç–æ `system/tools`; –ø–æ–º–Ω–∏—Ç—å, —á—Ç–æ —Å–º–µ–Ω–∞ `tool_choice` –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç
  –∫–µ—à; –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å emitter-schema.
- **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å Stores**: —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è, –º–µ–º–æ-—Å–µ–ª–µ–∫—Ç–æ—Ä—ã; —Ç–µ—Å—Ç—ã –Ω–∞ –ø–æ—Ä—è–¥–æ–∫ SID.
- **i18n —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ**: —Ä–∞–Ω–Ω—è—è –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –∫–ª—é—á–µ–π; –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–ª–æ–≤–∞—Ä–µ–π (—Å–∫—Ä–∏–ø—Ç—ã).

---

## 5) –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã

- –î–∏–∞–≥—Ä–∞–º–º–∞ –º–æ–¥—É–ª–µ–π (Mermaid) –≤ `doc/architecture.mmd` (–æ–±–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ S2).
- –®–∞–±–ª–æ–Ω PR-—á–µ–∫–ª–∏—Å—Ç–∞ (DoD + —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø—É–Ω–∫—Ç—ã –¢–ó).
- –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ —Å `tools/tool_choice` –∏ —Ä–∞–∑–±–æ—Ä–æ–º `tool_use.input` (–º–∏–Ω–∏-–≥–∞–π–¥ –≤
  `doc/best_practices/tool-use.md` ‚Äî —Å—Å—ã–ª–∫–∞ –∏–∑ README/AGENT/Codex).
